@page
@model IndexModel
@using System.Web
@{
    ViewData["Title"] = "Home - Fresh Farm Market";
}

<div class="container mt-4">
    <div class="row">
  <div class="col-12">
    <div class="card shadow-lg">
  <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
    <h3 class="mb-0"><i class="bi bi-house-door"></i> Welcome to Fresh Farm Market</h3>
  @if (Model.CurrentUser != null)
 {
<small class="text-white-50">
     <i class="bi bi-shield-check"></i> Session Active
  @if (Model.CurrentUser.EmailConfirmed)
       {
   <span class="badge bg-light text-success ms-2">Verified</span>
         }
   </small>
  }
 </div>
  <div class="card-body">
        @if (Model.CurrentUser != null)
      {
   <div class="row">
      <div class="col-md-3 text-center mb-4">
   @if (!string.IsNullOrEmpty(Model.CurrentUser.PhotoPath))
    {
 <img src="@Model.CurrentUser.PhotoPath" alt="Profile Photo" class="img-thumbnail rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
 }
      else
   {
<div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center mx-auto" style="width: 150px; height: 150px;">
    <i class="bi bi-person-fill text-white" style="font-size: 4rem;"></i>
         </div>
}
  
       @* Account Status Badges *@
        <div class="mt-3">
       @if (Model.CurrentUser.TwoFactorEnabled)
     {
        <span class="badge bg-success"><i class="bi bi-shield-lock"></i> 2FA Enabled</span>
    }
         else
   {
     <span class="badge bg-warning text-dark"><i class="bi bi-shield-exclamation"></i> 2FA Disabled</span>
      }
     </div>
       </div>
    <div class="col-md-9">
        <h4 class="text-success">@HttpUtility.HtmlDecode(Model.CurrentUser.FullName)</h4>
 <hr />

       <div class="row">
           <div class="col-md-6">
   <table class="table table-borderless">
    <tr>
<th width="40%"><i class="bi bi-envelope"></i> Email:</th>
       <td>
<span>@Model.CurrentUser.Email</span>
    @if (Model.CurrentUser.EmailConfirmed)
  {
 <i class="bi bi-check-circle-fill text-success" title="Verified"></i>
 }
  </td>
    </tr>
     <tr>
     <th><i class="bi bi-gender-ambiguous"></i> Gender:</th>
 <td>@Model.CurrentUser.Gender</td>
      </tr>
 <tr>
        <th><i class="bi bi-telephone"></i> Mobile:</th>
      <td>
 <span>@Model.CurrentUser.MobileNo</span>
@if (Model.CurrentUser.PhoneNumberConfirmed)
 {
<i class="bi bi-check-circle-fill text-success" title="Verified"></i>
            }
   </td>
 </tr>
    <tr>
        <th><i class="bi bi-geo-alt"></i> Address:</th>
    <td>@HttpUtility.HtmlDecode(Model.CurrentUser.DeliveryAddress)</td>
   </tr>
   </table>
</div>
 <div class="col-md-6">
   <table class="table table-borderless">
     <tr>
      <th width="40%"><i class="bi bi-credit-card"></i> Credit Card:</th>
     <td>
  <span class="text-danger fw-bold font-monospace">@Model.DecryptedCreditCard</span>
        <small class="text-muted d-block">(Decrypted for display)</small>
      </td>
       </tr>
<tr>
<th><i class="bi bi-calendar-plus"></i> Joined:</th>
    <td>@Model.CurrentUser.CreatedAt.ToString("dd MMM yyyy HH:mm")</td>
 </tr>
       <tr>
    <th><i class="bi bi-box-arrow-in-right"></i> Last Login:</th>
   <td>@(Model.CurrentUser.LastLoginAt?.ToString("dd MMM yyyy HH:mm") ?? "N/A")</td>
    </tr>
      @if (Model.CurrentUser.PasswordLastChangedAt.HasValue)
   {
     <tr>
<th><i class="bi bi-key"></i> Password Changed:</th>
       <td>@Model.CurrentUser.PasswordLastChangedAt.Value.ToString("dd MMM yyyy HH:mm")</td>
    </tr>
      }
   </table>
       </div>
 </div>

    <div class="mt-3">
   <h5><i class="bi bi-person-lines-fill"></i> About Me</h5>
   <div class="p-3 bg-light rounded">
    @HttpUtility.HtmlDecode(Model.CurrentUser.AboutMe)
 </div>
         </div>
  </div>
 </div>

  <hr class="my-4" />

        @* Action Buttons *@
   <div class="row g-3">
       <div class="col-md-3">
      <a asp-page="/ChangePassword" class="btn btn-outline-primary w-100">
<i class="bi bi-key"></i> Change Password
         </a>
 </div>
  <div class="col-md-3">
         <a asp-page="/Setup2fa" class="btn btn-outline-warning w-100">
       <i class="bi bi-shield-lock"></i> Setup 2FA
     </a>
      </div>
     <div class="col-md-3">
         <a asp-page="/AuditLogs" class="btn btn-outline-info w-100">
    <i class="bi bi-journal-text"></i> View Activity
   </a>
    </div>
        <div class="col-md-3">
         <form method="post" asp-page="/Logout">
   <button type="submit" class="btn btn-outline-danger w-100">
       <i class="bi bi-box-arrow-right"></i> Logout
  </button>
        </form>
      </div>
        </div>
        }
   else
   {
<div class="text-center py-5">
<i class="bi bi-lock text-muted" style="font-size: 4rem;"></i>
   <h4 class="mt-3">Session Expired or Not Logged In</h4>
<p class="text-muted">Please log in to view your profile.</p>
      <a asp-page="/Login" class="btn btn-success btn-lg">
      <i class="bi bi-box-arrow-in-right"></i> Login
  </a>
        </div>
  }
   </div>
    </div>
 </div>
    </div>
</div>
