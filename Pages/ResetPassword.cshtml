@page
@model WebApplication1.Pages.ResetPasswordModel
@{
    ViewData["Title"] = "Reset Password - Fresh Farm Market";
}

<div class="container mt-5">
    <div class="row justify-content-center">
   <div class="col-md-5">
   <div class="card shadow">
 <div class="card-header bg-success text-white">
          <h4 class="mb-0"><i class="bi bi-shield-lock"></i> Reset Password</h4>
    </div>
   <div class="card-body">
          @if (!string.IsNullOrEmpty(Model.StatusMessage))
  {
    <div class="alert alert-success">
    <i class="bi bi-check-circle"></i> @Model.StatusMessage
   </div>
 <div class="text-center mt-3">
     <a asp-page="/Login" class="btn btn-success">
     <i class="bi bi-box-arrow-in-right"></i> Go to Login
  </a>
     </div>
      }
else if (!string.IsNullOrEmpty(Model.ErrorMessage))
   {
     <div class="alert alert-danger">
           <i class="bi bi-exclamation-triangle"></i> @Model.ErrorMessage
       </div>
      <div class="text-center mt-3">
       <a asp-page="/ForgotPassword" class="btn btn-warning">
    <i class="bi bi-arrow-repeat"></i> Request New Link
    </a>
   </div>
      }
    else
         {
     <p class="text-muted mb-4">Enter your new password below.</p>

    <form method="post">
       <input type="hidden" asp-for="Input.UserId" />
 <input type="hidden" asp-for="Input.Token" />
       <div asp-validation-summary="All" class="alert alert-danger" role="alert"></div>

       <div class="mb-3">
     <label class="form-label" asp-for="Input.NewPassword"></label>
        <div class="input-group">
           <input type="password" id="newPassword" asp-for="Input.NewPassword" class="form-control" />
  <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('newPassword')">
 <i class="bi bi-eye" id="newPassword-icon"></i>
   </button>
     </div>
    <span asp-validation-for="Input.NewPassword" class="text-danger"></span>
  <div id="passwordStrength" class="mt-2"></div>
   <small class="form-text text-muted">
 Min 12 characters with uppercase, lowercase, number, and special character
       </small>
 </div>

     <div class="mb-3">
 <label class="form-label" asp-for="Input.ConfirmPassword"></label>
   <div class="input-group">
   <input type="password" id="confirmPassword" asp-for="Input.ConfirmPassword" class="form-control" />
              <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirmPassword')">
   <i class="bi bi-eye" id="confirmPassword-icon"></i>
          </button>
        </div>
   <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
 </div>

     <div class="d-grid">
            <button type="submit" class="btn btn-success">
<i class="bi bi-check-circle"></i> Reset Password
           </button>
      </div>
      </form>
   }
 </div>
   </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
     function togglePassword(fieldId) {
     const field = document.getElementById(fieldId);
   const icon = document.getElementById(fieldId + '-icon');
if (field.type === 'password') {
         field.type = 'text';
  icon.classList.remove('bi-eye');
      icon.classList.add('bi-eye-slash');
   } else {
        field.type = 'password';
       icon.classList.remove('bi-eye-slash');
  icon.classList.add('bi-eye');
  }
      }

        // Password strength indicator
    document.getElementById('newPassword')?.addEventListener('input', function () {
            const password = this.value;
     const strengthDiv = document.getElementById('passwordStrength');
 let strength = 0;
            let feedback = [];

     if (password.length >= 12) strength++; else feedback.push('12+ characters');
     if (/[A-Z]/.test(password)) strength++; else feedback.push('Uppercase');
 if (/[a-z]/.test(password)) strength++; else feedback.push('Lowercase');
    if (/\d/.test(password)) strength++; else feedback.push('Number');
    if (/[^a-zA-Z0-9]/.test(password)) strength++; else feedback.push('Special char');

 let color = strength < 3 ? 'danger' : strength < 5 ? 'warning' : 'success';
       let text = strength < 3 ? 'Weak' : strength < 5 ? 'Medium' : 'Strong';

   if (password.length > 0) {
        strengthDiv.innerHTML = '<div class="progress" style="height:5px"><div class="progress-bar bg-' + color + '" style="width:' + (strength * 20) + '%"></div></div><small class="text-' + color + '">' + text + '</small>' + (feedback.length ? '<br><small class="text-muted">Need: ' + feedback.join(', ') + '</small>' : '');
       } else {
         strengthDiv.innerHTML = '';
  }
        });
    </script>
}
