@page
@model WebApplication1.Pages.ChangePasswordModel
@{
    ViewData["Title"] = "Change Password";
}

<div class="container mt-5">
    <div class="row justify-content-center">
   <div class="col-md-6">
      <div class="card shadow">
    <div class="card-header bg-primary text-white">
        <h3 class="mb-0"><i class="bi bi-key"></i> Change Password</h3>
       </div>
   <div class="card-body">
           @if (!string.IsNullOrEmpty(Model.StatusMessage))
 {
  <div class="alert alert-success" role="alert">
       @Model.StatusMessage
        </div>
      }

      <form method="post">
     <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

     @* Current Password *@
  <div class="mb-3">
        <label class="form-label" asp-for="Input.CurrentPassword"></label>
       <input type="password" asp-for="Input.CurrentPassword" class="form-control" />
    <span asp-validation-for="Input.CurrentPassword" class="text-danger"></span>
            </div>

        @* New Password *@
     <div class="mb-3">
     <label class="form-label" asp-for="Input.NewPassword"></label>
   <input type="password" id="newPassword" asp-for="Input.NewPassword" class="form-control" />
     <span asp-validation-for="Input.NewPassword" class="text-danger"></span>
    <div id="passwordStrength" class="mt-2"></div>
        <small class="form-text text-muted">
   Minimum 12 characters with uppercase, lowercase, numbers, and special characters.
You cannot reuse your last 2 passwords.
         </small>
  </div>

    @* Confirm New Password *@
     <div class="mb-3">
  <label class="form-label" asp-for="Input.ConfirmNewPassword"></label>
            <input type="password" asp-for="Input.ConfirmNewPassword" class="form-control" />
   <span asp-validation-for="Input.ConfirmNewPassword" class="text-danger"></span>
    </div>

      <div class="d-grid gap-2">
       <button type="submit" class="btn btn-primary">
 <i class="bi bi-check-circle"></i> Change Password
      </button>
         <a asp-page="/Index" class="btn btn-outline-secondary">
     <i class="bi bi-arrow-left"></i> Back to Profile
     </a>
   </div>
         </form>
 </div>
       </div>
 </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Password strength indicator
        document.getElementById('newPassword').addEventListener('input', function () {
      const password = this.value;
  const strengthDiv = document.getElementById('passwordStrength');
     let strength = 0;
   let feedback = [];

        if (password.length >= 12) strength++;
   else feedback.push('At least 12 characters');

       if (/[A-Z]/.test(password)) strength++;
 else feedback.push('Uppercase letter');

  if (/[a-z]/.test(password)) strength++;
     else feedback.push('Lowercase letter');

    if (/\d/.test(password)) strength++;
  else feedback.push('Number');

     if (/[!#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~`]/.test(password)) strength++;
   else feedback.push('Special character');

            let color = 'danger';
   let text = 'Weak';
 if (strength >= 4) { color = 'warning'; text = 'Medium'; }
if (strength === 5) { color = 'success'; text = 'Strong'; }

if (password.length > 0) {
  strengthDiv.innerHTML = '<div class="progress" style="height: 5px;"><div class="progress-bar bg-' + color + '" style="width: ' + (strength * 20) + '%"></div></div><small class="text-' + color + '">' + text + '</small>' + (feedback.length > 0 ? '<br><small class="text-muted">Missing: ' + feedback.join(', ') + '</small>' : '');
     } else {
       strengthDiv.innerHTML = '';
     }
        });
    </script>
}
